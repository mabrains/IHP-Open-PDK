# =========================================================================================
# Copyright 2025 IHP PDK Authors
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# =========================================================================================

# ==============================================================
# PDK Models Setup
# ==============================================================
# Define the paths to measurement data and PDK model libraries
# ==============================================================

# Path to measured device model directory (raw measurement data)
mdm_dir: "../../../../libs.doc/meas/MOS/SG13_pmosHVXm1Y3"

# Path to the PDK-provided model library (corner definitions)
corner_lib_path: "../../../../libs.tech/ngspice/models/cornerMOShv.lib"

# Path to the compiled OSDI model file for MOSFETs
osdi_path: "../../../../libs.tech/ngspice/osdi/psp103_nqs.osdi"

# ==============================================================
# Device Configuration
# ==============================================================
# Specify device type and name to clearly identify which
# transistor or component this configuration applies to
# ==============================================================

# Device category (e.g. hbt, mos, resistor, capacitor, etc.)
device_type: "mos"

# Specific device name inside the PDK
device_name: "sg13_hv_pmos"

# ==============================================================
# Run Configuration
# ==============================================================
# Control how simulations are run and how many resources are used
# ==============================================================

# Path to the DC analysis template (Jinja2 format)
dc_template_path: "configs/mos/dc_template.spice.j2"

# Maximum number of workers (parallel jobs).
# Set based on your system CPU cores.
max_workers: 8

# ==============================================================
# Output and Validation Settings
# ==============================================================

# ----------------------------------------------------
# Validation Threshold Configuration
# ----------------------------------------------------
# threshold_percent_oob defines the **maximum allowed percentage (%) of points**
# that can fall **outside the valid model envelope** (out-of-bound, OOB)
# for each sweep or test condition.
#
# This parameter controls the overall pass/fail criteria for each dataset:
# - If the fraction of OOB points ≤ threshold → the sweep passes.
# - If the fraction of OOB points > threshold → the sweep fails.
#
# Example:
#   Total sweep points = 200
#   Out-of-bound points = 1
#   threshold_percent_oob = 0.5
#
#   (1 / 200) × 100 = 0.5% <= 5% → PASS
#
#   If 2 points were out of bounds → (1%) > 0.5% → FAIL

threshold_percent_oob: 0.5

# ----------------------------------------------------
# Corner Envelope Tolerance Configuration
# ----------------------------------------------------
# corner_tolerance_percent defines the **relative tolerance percentage**
# added to the FF/SS simulation envelopes to account for expected
# statistical process variation (based on σ-level confidence).
#
# The value represents the percentage of samples expected to fall
# *outside* the FF/SS limits for a given σ coverage:
#
#   - 1σ → 100 - 68.27 = 31.73%
#   - 2σ → 100 - 95.45 = 4.55%
#   - 3σ → 100 - 99.73 = 0.27%
#   - 4σ → 100 - 99.9937 = 0.0063%
#   - 5σ → 100 - 99.99994 = 0.00006%
#   - 6σ → 100 - 99.9999998 = 0.0000002%
#
# Example:
#   If corner_tolerance_percent = 0.27
#   - Effective FF bound = FF_sim_value × (1 + 0.0027)
#   - Effective SS bound = SS_sim_value × (1 - 0.0027)
#
# This means the FF and SS bounds are extended by ±0.27% of their values.
#
corner_tolerance_percent: 0.27

# ----------------------------------------------------
# Current Clipping Configuration
# ----------------------------------------------------
# clip_curr sets the minimum current level (in Amperes) below which
# current measurements are ignored during validation.
# This helps avoid false OOB flags due to noise in very low current regions.

clip_curr: 1e-11   # A

# ==============================================================
# Metrics Definitions
# ==============================================================
# Naming convention:
#   *_meas = measured value
#   *_sim_* = simulated values (typ/bcs/Wcs = corners)
# ==============================================================

metrics:
  - name: "id"   # Drain current
    meas: "id_meas"
    tt: "id_sim_mos_tt"
    ss: "id_sim_mos_ss"
    ff: "id_sim_mos_ff"

  - name: "is"   # Source current
    meas: "is_meas"
    tt: "is_sim_mos_tt"
    ss: "is_sim_mos_ss"
    ff: "is_sim_mos_ff"

  - name: "ib"   # Bulk (body) current
    meas: "ib_meas"
    tt: "ib_sim_mos_tt"
    ss: "ib_sim_mos_ss"
    ff: "ib_sim_mos_ff"

  - name: "ig"   # Gate current
    meas: "ig_meas"
    tt: "ig_sim_mos_tt"
    ss: "ig_sim_mos_ss"
    ff: "ig_sim_mos_ff"

# ==============================================================
# Output Paths
# ==============================================================
# Directory where processed results will be stored
# ==============================================================

output_dir: "models_results/pmos_hv"
